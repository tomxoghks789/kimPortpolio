<!DOCTYPE html>
<html lang="en">
<head>
<title>김태환의 포트폴리오</title>
<link rel="shortcut icon" href="./images/favicon.ico" type="image/x-icon">
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta property="og:title" content="안녕하세요 김태환의 포트폴리오입니다!"/>
<meta property="og:description" content="Kim Tae Hwan's Portfolio"/>
<meta property="og:image" content="./images/showimage.png"/>
<meta name="description" content="">
<meta name="keywords" content="">
<meta name="author" content="">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="css/magnific-popup.css">
<link rel="stylesheet" href="css/font-awesome.min.css">
<!-- MAIN CSS -->
<link rel="stylesheet" href="css/templatemo-style.css">
<link rel="stylesheet" href="css/kimcustom.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/vs2015.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script> <script>hljs.initHighlightingOnLoad();</script>
</head>
<body>

<!-- PRE LOADER -->
<section class="preloader">
  <div class="spinner"> <span class="spinner-rotate"></span> </div>
</section>

<!-- MENU -->
<section class="navbar custom-navbar navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse"> <span class="icon icon-bar"></span> <span class="icon icon-bar"></span> <span class="icon icon-bar"></span> </button>
      
      <!-- lOGO TEXT HERE --> 
      <a href="index.html" class="navbar-brand"><b>김태환의 포트폴리오</b></a> </div>
    
    <!-- MENU LINKS -->
    <div class="collapse navbar-collapse">
      <ul class="nav navbar-nav navbar-nav-first">
        <li><a href="index.html#home" class="smoothScroll">Home</a></li>
        <li><a href="index.html#about" class="smoothScroll">About me</a></li>
        <li><a href="index.html#blog" class="smoothScroll">My work</a></li>
        <li><a href="index.html#work" class="smoothScroll">Paper & award</a></li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li><a href="https://github.com/tomxoghks789?tab=repositories"><i class="fa fa-github"></i></a></li>
        <li><a href="https://laruma.tistory.com/" class="smoothScroll"><img src="images/tistory.png" alt="" class="white"/><img src="images/tistoryover.png" alt="" class="red"/><img src="images/tistoryblack.png" alt="" class="black"/></a></li>
      </ul>
    </div>
  </div>
</section>

<!-- BLOG HEADER -->
<section id="blog-header" data-stellar-background-ratio="0.5">
  <div class="overlay"></div>
  <div class="container">
    <div class="row">
      <div class="col-md-offset-1 col-md-5 col-sm-12">
        <h2><b>상상을 현실로 이뤄내는 일을 하는<br>
          개발자를 꿈꿉니다</b></h2>
      </div>
    </div>
  </div>
</section>

<!-- BLOG DETAIL -->
<section id="blog-detail" data-stellar-background-ratio="0.5">
  <div class="container">
    <div class="row">
      <div class="col-md-offset-1 col-md-10 col-sm-12"> 
        <!-- BLOG THUMB -->
        <div class="blog-detail-thumb">
          <div class="blog-image"> <img src="images/blog-detail-image.jpg" class="img-responsive" alt="Blog Image"> </div>
          <h2>교내 중고거래 모바일 앱 딜잇</h2>
          <p>인천대학교 졸업작품 프로젝트로 4인 프로젝트였습니다. 저의 담당은 아래와 같습니다.<br>
          </p>
          <ul>
            <li>사용자간 채팅 구현</li>
            <li>FCM을 통한 상품등록 Push 송수신</li>
            <li>상품 등록기능 및 상품 이미지 수신 서버 구현</li>
          </ul>
          <p>이 프로젝트에 적용된 기술은 아래와 같습니다.<br>
          </p>
          <ul>
            <li>Java</li>
            <li>FCM</li>
            <li>Android</li>
            <li>Multi-Thread</li>
            <li>MySQL</li>
            <li>TCP/IP</li>
          </ul>
          <br>
          <img src="images/d1.jpg" alt=""/> <br>
          <br>
          <br>
          <iframe width="800" height="515" src="https://www.youtube.com/embed/gqv1T6sQ7jk" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
          <blockquote>앱에서의 상품등록과 채팅기능 시연 영상</blockquote>
          
          <p>사용자는 메뉴에서 관심있는 해시태그를 등록하면 해당 해시태그를 가진 상품이 등록될 때 알림을 받을 수 있습니다. Push 알림은 FCM기반이며 모바일 디바이스가 아닌 서버에서 전송합니다.</p>
<pre><code class="java">
// FCM 기반의 Push 전송
// 사용자가 알람을 받기 희망하는 해쉬태그를 가진 상품이 업로드 될때 Multi Thread 기반의 서버에서 Push 전송하는 코드
class PushSender extends Thread
{
	public final static String AUTH_KEY_FCM = "AAAA3GXD.."; 
	public final static String API_URL_FCM = "https://fcm.googleapis.com/fcm/send";
	Socket socket;
	DataInputStream dis;
	FileOutputStream fos;
	BufferedOutputStream bos;
	ArrayList<String> tokens;
	String Query;

	public PushSender(Socket socket)
	{
		this.socket = socket;
	}

	@Override
	public void run()
	{
		try
		{
			tokens = new ArrayList<String>();
			dis = new DataInputStream(socket.getInputStream());
			String hashtags = dis.readUTF();
			dis.close();
			System.out.println(hashtags);
			String[] hashTag_Array;
			hashtags = hashtags.replace(" ", "");
			hashTag_Array = hashtags.split("#"); // 해시태그를 # 단위로 자름
			Connection conn = null; // Database 연결을 위한 컨넥션 객체 선언
			ResultSet rSet = null; // Query 결과를 저장하는 객체 선언
			Statement stmt = null; // stmp 또는 pstmp를 선언하여 사용할 수 있다.
			for (int i = 0; i < hashTag_Array.length; i++) // 해시태그의 갯수 만큼 실행
			{
				tokens.clear();
				try
				{
					// DB로부터 알람 희망자를 조회하는 코드
					Class.forName(DB_Setting_Value.Setting_Value.DBCLASS).newInstance();
					conn = DriverManager.getConnection(DB_Setting_Value.Setting_Value.SERVER_DB_IP, DB_Setting_Value.Setting_Value.DBID, DB_Setting_Value.Setting_Value.DBPW);
					stmt = conn.createStatement();
					Query = "SELECT token FROM User_Info AS INFO INNER JOIN User_Hashtag AS HASHTAG ON INFO.ID = HASHTAG.UserID WHERE Hashtag = '" + hashTag_Array[i] + "';";
					System.out.println(Query);
					rSet = stmt.executeQuery(Query);
					while (rSet.next())
					{
						tokens.add(rSet.getString(1));
					}
					// Push 전송
					System.out.println(tokens);
					for (int j = 0; j < tokens.size(); j++)
					{
						sendPushNotification(tokens.get(j), hashTag_Array[i]);
					}
				...
	// 알람 전송 메소드
	public void sendPushNotification(String deviceToken, String tagName) throws IOException
	{
		String result = "";
		URL url = new URL(API_URL_FCM);
		HttpURLConnection conn = (HttpURLConnection) url.openConnection();

		conn.setUseCaches(false);
		conn.setDoInput(true);
		conn.setDoOutput(true);

		conn.setRequestMethod("POST");
		conn.setRequestProperty("Authorization", "key=" + AUTH_KEY_FCM);
		conn.setRequestProperty("Content-Type", "application/json");

		JSONObject json = new JSONObject(); // Json 형태로 Push에 필요한 데이터를 담아 요청
		json.put("to", deviceToken.trim());
		JSONObject info = new JSONObject();
		info.put("title", "등록 알림!"); // Notification title
		info.put("body", tagName); // Notification
		json.put("data", info);

		try
		{
			OutputStreamWriter wr = new OutputStreamWriter(conn.getOutputStream(), "UTF-8");
			wr.write(json.toString());
			wr.flush();
			BufferedReader br = new BufferedReader(new InputStreamReader((conn.getInputStream())));
		...
	}
}

</code>
</pre>
          <p><br>
            이미지의 경우 TCP/IP Socket 통신으로 서버에 전송하여 저장하게 됩니다.<br>
            <br>
          </p>
          <pre><code class="java">
// 서버 프로그램 코드
ServerSocket serverSocket = null;
Socket socket = null;
try
{
	// 리스너 소켓 생성 후 대기
	serverSocket = new ServerSocket(7777);
	System.out.println("DealIt Image Server Running..");
}
catch (IOException e)
{
	e.printStackTrace();	
}
while ((true))
{
	try
	{
		socket = serverSocket.accept();
		System.out.println("Receiving..");
		// 파일 수신 작업 시작
		FileReceiver imageReceiver = new FileReceiver(socket);
		imageReceiver.start();
	}
	catch (Exception e)
	{
		System.out.println(e.toString());
	}
}</code></pre>
          <pre><code class="java">
// 안드로이드 디바이스에서 이미지를 전송하는것은 AsyncTask를 사용하였습니다.
public class Image_Uploader extends AsyncTask<String, String, String>
{
	String File_Path;
	String ID;
	String sendBack;
	Context exCon;
	...
	Socket socket = null;
	DataOutputStream dos;
	FileInputStream fis;
	BufferedInputStream bis;
try
{
	String userName = ID;
	socket = new Socket(serverIp, DB_Setting_Value.Setting_Value.IMAGE_SERVER_PORT); // 자주사용되는 값들은 DB_Setting_Value.Setting_Value에 상수값으로 선언해놓았습니다.
	dos = new DataOutputStream(socket.getOutputStream());
	sendBack = userName + "_" + new SimpleDateFormat("yy-MM-dd_ss").format(new Date()) + ".jpg";
	dos.writeUTF(sendBack);
	File imageFile = new File(File_Path);
	fis = new FileInputStream(imageFile);
	bis = new BufferedInputStream(fis);
	int len;
	int size = 4096;
	byte[] data = new byte[size];
	while ((len = bis.read(data)) != -1)
	{
		dos.write(data, 0, len);
	}
	dos.flush();
	dos.close();
	bis.close();
	fis.close();
...
</code></pre>

          <p><br>
            나머지 기능의 경우 DB 연동이 필요하거나 외부와 통신이 필요한 경우 모두 AsyncTask를 사용하여 구현하였고 Context를 활용하여 결과값을 UI에 적용시켰습니다.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- FOOTER -->
<footer data-stellar-background-ratio="0.5">
  <div class="container">
    <div class="row">
      <div class="col-md-12 col-sm-12">
        <div class="footer-bottom">
          <div class="col-md-6 col-sm-5">
            <div class="footer-thumb footer-info">
              <h2>Thank you for watching</h2>
              <p>읽어주셔서 감사합니다.</p>
            </div>
            <div class="copyright-text">
              <p>Copyright &copy; 2020 Kim Tae Hwan's Portfolio</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</footer>

<!-- SCRIPTS --> 
<script src="js/jquery.js"></script> 
<script src="js/bootstrap.min.js"></script> 
<script src="js/jquery.stellar.min.js"></script> 
<script src="js/jquery.magnific-popup.min.js"></script> 
<script src="js/smoothscroll.js"></script> 
<script src="js/custom.js"></script>
</body>
</html>